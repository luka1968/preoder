# 🎉 PreOrder Pro - 开始使用

## ✅ 配置已完成！

所有必要的配置文件已经创建并配置好了：

- ✅ `.env` - 生产环境变量
- ✅ `.env.local` - 本地开发变量  
- ✅ `shopify.app.toml` - Shopify CLI 配置
- ✅ 预购按钮库存为0的bug已修复

---

## 🚀 快速开始（3步）

### 1️⃣ 安装依赖

```bash
# 运行快速启动脚本
quick-start.bat

# 选择选项 1: 安装所有依赖
```

或手动安装：

```bash
npm install
npm install -g @shopify/cli @shopify/app
npm install -g vercel
```

### 2️⃣ 部署到 Vercel

```bash
# 使用快速启动脚本
quick-start.bat
# 选择选项 5: 完整部署流程

# 或手动部署
vercel login
vercel --prod
```

### 3️⃣ 部署 Shopify 扩展

```bash
# 已包含在完整部署流程中

# 或手动部署
cd extensions/preorder-embed
shopify app deploy
```

---

## 📝 详细步骤

### 步骤1: 本地开发（可选）

```bash
# 启动开发服务器
npm run dev

# 或使用 Shopify CLI
shopify app dev
```

访问：`http://localhost:3000`

### 步骤2: 部署到 Vercel

#### 使用脚本（推荐）

```bash
vercel-deploy.bat
# 选择选项 3: 部署到生产环境
```

#### 手动部署

```bash
# 登录
vercel login

# 部署
vercel --prod

# 记录部署的 URL
# 例如: https://shopmall.dpdns.org
```

### 步骤3: 部署 Shopify 扩展

```bash
# 登录 Shopify
shopify auth login

# 进入扩展目录
cd extensions/preorder-embed

# 部署扩展
shopify app deploy

# 返回项目根目录
cd ../..
```

### 步骤4: 在 Shopify 中启用

1. **安装 App 到开发店铺**
   - 使用 `shopify app dev`
   - 或在 Partners 后台手动安装

2. **启用 App Embed**
   ```
   Shopify Admin 
   → Online Store 
   → Themes 
   → Customize 
   → App embeds 
   → 找到 "PreOrder Pro - 预购插件" 
   → 打开开关 
   → Save
   ```

3. **创建测试商品**
   ```
   Products 
   → Add product 
   → 设置库存为 0 
   → Save
   ```

4. **访问商品页面验证**
   - 应该看到预购按钮（橙色渐变）
   - 应该看到预购徽章（图片右上角）
   - 原"加入购物车"按钮应该隐藏

---

## 🎯 使用脚本快速操作

### quick-start.bat（主脚本）

```bash
quick-start.bat
```

功能：
- [1] 安装所有依赖
- [2] 启动本地开发服务器
- [3] 部署到 Vercel
- [4] 部署 Shopify 扩展
- [5] 完整部署流程（推荐）
- [6] 查看文档

### vercel-deploy.bat（Vercel专用）

```bash
vercel-deploy.bat
```

功能：
- 登录 Vercel
- 部署到预览/生产环境
- 查看部署状态
- 管理环境变量

---

## 📚 文档

### 主要文档

1. **本地开发和部署指南.md** ⭐
   - 完整的开发和部署流程
   - 常用命令参考
   - 问题排查指南

2. **最终部署说明.md**
   - 部署总结
   - 架构说明
   - 测试清单

3. **APP_EMBED_安装指南.md**
   - App Embed 详细说明
   - 用户使用指南
   - 对比分析

4. **修复说明_中文.md**
   - Bug 修复详情
   - 技术细节
   - 测试方法

---

## 🧪 测试清单

### 部署后测试

- [ ] Vercel 部署成功
- [ ] 访问 `https://你的域名.vercel.app/shopify-integration.js` 能看到代码
- [ ] Shopify 扩展部署成功
- [ ] 在 Partners 后台能看到扩展

### 功能测试

- [ ] App 已安装到开发店铺
- [ ] App Embed 已启用
- [ ] 创建了库存为0的测试商品
- [ ] 访问商品页面能看到预购按钮
- [ ] 预购徽章显示在图片上
- [ ] 点击预购按钮功能正常
- [ ] 浏览器控制台无错误

### 多场景测试

- [ ] 库存为0 → 显示预购 ✅
- [ ] 负库存 → 显示预购 ✅
- [ ] 有库存 → 不显示预购 ✅
- [ ] 多变体切换正常 ✅
- [ ] 移动端显示正常 ✅

---

## 🔧 常用命令

### 开发

```bash
# 启动开发服务器
npm run dev

# 使用 Shopify CLI
shopify app dev
```

### 部署

```bash
# 部署到 Vercel
vercel --prod

# 部署 Shopify 扩展
cd extensions/preorder-embed
shopify app deploy
```

### 查看状态

```bash
# Vercel 部署列表
vercel ls

# Shopify App 信息
shopify app info

# 查看扩展
shopify app extension list
```

---

## 🐛 遇到问题？

### 常见问题

1. **Shopify CLI 找不到配置**
   - 确认 `shopify.app.toml` 存在
   - 确认 `client_id` 已设置

2. **环境变量未加载**
   - 检查 `.env.local` 文件
   - 重启开发服务器

3. **扩展部署失败**
   - 重新登录：`shopify auth logout && shopify auth login`
   - 检查扩展配置文件

4. **Vercel 部署失败**
   - 检查构建日志：`vercel logs`
   - 确认环境变量已设置

### 获取帮助

查看详细文档：
- `本地开发和部署指南.md` - 完整指南
- `APP_EMBED_安装指南.md` - App Embed 说明

---

## ⚠️ 重要提醒

### 安全注意事项

**你的密钥已经在聊天中泄露！** 

部署完成后，请立即：

1. **重新生成 Shopify API 密钥**
   - 访问 [Shopify Partners](https://partners.shopify.com/)
   - App setup → Client credentials → Rotate

2. **重新生成 Supabase 密钥**
   - 访问 [Supabase Dashboard](https://supabase.com/dashboard)
   - Settings → API → Reset keys

3. **更新所有配置文件**
   - 更新 `.env`
   - 更新 `.env.local`
   - 更新 `shopify.app.toml`
   - 更新 Vercel 环境变量

4. **检查访问日志**
   - Shopify App 安装记录
   - Supabase 访问日志
   - 邮件发送记录

---

## 🎉 完成！

现在你可以：

1. ✅ 使用 `quick-start.bat` 快速操作
2. ✅ 使用 Shopify CLI 开发和部署
3. ✅ 使用 Vercel CLI 部署到生产环境
4. ✅ 在开发店铺测试预购功能

**预购按钮的库存为0 bug 已修复，可以正常使用了！** 🚀

---

## 📞 下一步

1. **立即部署**
   ```bash
   quick-start.bat
   # 选择选项 5: 完整部署流程
   ```

2. **测试功能**
   - 创建库存为0的商品
   - 访问商品页面
   - 验证预购按钮显示

3. **重新生成密钥**（重要！）
   - Shopify API 密钥
   - Supabase 密钥
   - 其他敏感信息

**祝部署顺利！** 🎊
