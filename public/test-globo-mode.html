<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Globo æ¨¡å¼åŠŸèƒ½æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 32px;
            font-size: 36px;
        }

        .test-section {
            margin-bottom: 32px;
            padding: 24px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 16px;
            font-size: 24px;
        }

        .test-section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .product-mock {
            background: white;
            padding: 24px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .product-image {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            margin-bottom: 20px;
            position: relative;
        }

        .product-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
        }

        .product-price {
            font-size: 28px;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .inventory-status {
            display: inline-block;
            padding: 8px 16px;
            background: #fee;
            color: #d63031;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 16px;
        }

        button {
            width: 100%;
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
            margin-top: 12px;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .log {
            background: #2d3436;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 8px;
        }

        .log-entry.success {
            color: #00ff00;
        }

        .log-entry.error {
            color: #ff6b6b;
        }

        .log-entry.info {
            color: #74b9ff;
        }

        .config-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .config-item {
            margin-bottom: 16px;
        }

        .config-item label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .config-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .config-item input:focus {
            outline: none;
            border-color: #667eea;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active {
            background: #00b894;
            box-shadow: 0 0 10px #00b894;
        }

        .status-indicator.inactive {
            background: #d63031;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸš€ Globo æ¨¡å¼åŠŸèƒ½æµ‹è¯•</h1>

        <!-- Test Section 1: Product Display -->
        <div class="test-section">
            <h2>
                <span class="status-indicator active"></span>
                æµ‹è¯• 1ï¼šå”®ç½„å•†å“å±•ç¤º
            </h2>
            <p>æ¨¡æ‹Ÿä¸€ä¸ªå”®ç½„å•†å“ï¼Œæµ‹è¯•é¢„è´­æŒ‰é’®å’Œå¾½ç« çš„æ˜¾ç¤ºã€‚</p>

            <div class="product-mock" id="product-display">
                <div class="product-image" id="product-image">
                    ğŸ›ï¸
                </div>
                <div class="product-title">é™é‡æ¬¾è®¾è®¡å¸ˆå¤–å¥—</div>
                <div class="product-price">$299.00</div>
                <div class="inventory-status">âŒ å·²å”®ç½„ Sold Out</div>

                <button class="btn-secondary" onclick="simulateSoldOut()">
                    æ¨¡æ‹Ÿå”®ç½„çŠ¶æ€
                </button>
            </div>
        </div>

        <!-- Test Section 2: Cart API -->
        <div class="test-section">
            <h2>
                <span class="status-indicator active"></span>
                æµ‹è¯• 2ï¼šShopify Cart API
            </h2>
            <p>æµ‹è¯•ä½¿ç”¨ Shopify Cart API åŠ å…¥è´­ç‰©è½¦ï¼ˆå¸¦é¢„è´­æ ‡è®°ï¼‰ã€‚</p>

            <div class="config-panel">
                <div class="config-item">
                    <label>Variant ID:</label>
                    <input type="text" id="variantId" value="12345678901234" placeholder="è¾“å…¥ variant ID">
                </div>
                <div class="config-item">
                    <label>é¢„è®¡å‘è´§æ—¥æœŸ:</label>
                    <input type="date" id="shippingDate" value="2025-12-15">
                </div>
            </div>

            <button class="btn-primary" onclick="testCartAPI()">
                ğŸ›’ æµ‹è¯•åŠ å…¥è´­ç‰©è½¦
            </button>

            <div class="log" id="cart-log">
                <div class="log-entry info">å‡†å¤‡å¥½æµ‹è¯• Cart API...</div>
            </div>
        </div>

        <!-- Test Section 3: Webhook Detection -->
        <div class="test-section">
            <h2>
                <span class="status-indicator active"></span>
                æµ‹è¯• 3ï¼šè®¢å•å±æ€§æ£€æµ‹
            </h2>
            <p>æµ‹è¯• webhook æ˜¯å¦èƒ½æ­£ç¡®æ£€æµ‹é¢„è´­è®¢å•æ ‡è®°ã€‚</p>

            <button class="btn-primary" onclick="testWebhookDetection()">
                ğŸ” æ¨¡æ‹Ÿ Webhook æ£€æµ‹
            </button>

            <div class="log" id="webhook-log">
                <div class="log-entry info">ç­‰å¾…æµ‹è¯•...</div>
            </div>
        </div>

        <!-- Test Section 4: Full Flow -->
        <div class="test-section">
            <h2>
                <span class="status-indicator active"></span>
                æµ‹è¯• 4ï¼šå®Œæ•´æµç¨‹æ¨¡æ‹Ÿ
            </h2>
            <p>æ¨¡æ‹Ÿä»ç‚¹å‡»é¢„è´­æŒ‰é’®åˆ°è®¢å•åˆ›å»ºçš„å®Œæ•´æµç¨‹ã€‚</p>

            <button class="btn-primary" onclick="testFullFlow()">
                ğŸ¬ è¿è¡Œå®Œæ•´æµç¨‹æµ‹è¯•
            </button>

            <div class="log" id="flow-log">
                <div class="log-entry info">å‡†å¤‡æµ‹è¯•å®Œæ•´æµç¨‹...</div>
            </div>
        </div>
    </div>

    <script>
        // æ—¥å¿—å·¥å…·
        function addLog(logId, message, type = 'info') {
            const log = document.getElementById(logId);
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog(logId) {
            document.getElementById(logId).innerHTML = '';
        }

        // Test 1: Simulate sold out status
        function simulateSoldOut() {
            const productImage = document.getElementById('product-image');

            // æ·»åŠ é¢„è´­å¾½ç« 
            const badge = document.createElement('div');
            badge.style.cssText = `
        position: absolute;
        top: 16px;
        left: 16px;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 4px 12px rgba(245, 87, 108, 0.4);
      `;
            badge.innerHTML = 'ğŸ”¥ é å”® Pre-Order';

            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨å¾½ç« 
            const existingBadge = productImage.querySelector('div');
            if (existingBadge) {
                existingBadge.remove();
            }

            productImage.appendChild(badge);

            // åˆ›å»ºé¢„è´­æŒ‰é’®
            const productDisplay = document.getElementById('product-display');
            const existingButton = productDisplay.querySelector('.preorder-btn');
            if (existingButton) {
                existingButton.remove();
            }

            const preorderBtn = document.createElement('button');
            preorderBtn.className = 'btn-primary preorder-btn';
            preorderBtn.style.marginTop = '16px';
            preorderBtn.innerHTML = `
        <span style="font-size: 20px;">ğŸ›’</span>
        <span>ç«‹å³é¢„è®¢ Pre-Order Now</span>
      `;
            preorderBtn.onclick = () => {
                alert('âœ… é¢„è´­æŒ‰é’®å·²æ¿€æ´»ï¼\n\nåœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œç‚¹å‡»æ­¤æŒ‰é’®ä¼šï¼š\n1. è°ƒç”¨ Shopify Cart API\n2. åŠ å…¥è´­ç‰©è½¦ï¼ˆå¸¦é¢„è´­æ ‡è®°ï¼‰\n3. è·³è½¬åˆ° /checkout');
            };

            productDisplay.appendChild(preorderBtn);

            alert('âœ… å”®ç½„çŠ¶æ€æ¨¡æ‹ŸæˆåŠŸï¼\n\nå·²æ·»åŠ ï¼š\n- é¢„è´­å¾½ç« \n- é¢„è´­æŒ‰é’®');
        }

        // Test 2: Test Cart API
        async function testCartAPI() {
            clearLog('cart-log');
            addLog('cart-log', 'ğŸš€ å¼€å§‹æµ‹è¯• Cart API...', 'info');

            const variantId = document.getElementById('variantId').value;
            const shippingDate = document.getElementById('shippingDate').value;

            if (!variantId) {
                addLog('cart-log', 'âŒ é”™è¯¯ï¼šè¯·è¾“å…¥ Variant ID', 'error');
                return;
            }

            addLog('cart-log', `ğŸ“¦ Variant ID: ${variantId}`, 'info');
            addLog('cart-log', `ğŸ“… é¢„è®¡å‘è´§: ${shippingDate}`, 'info');

            // æ¨¡æ‹Ÿ Cart API è¯·æ±‚
            const cartData = {
                items: [{
                    id: variantId,
                    quantity: 1,
                    properties: {
                        '_preorder': 'true',
                        '_æ˜¯é è³¼å•†å“': 'æ˜¯',
                        '_estimated_shipping': shippingDate,
                        '_é è¨ˆç™¼è²¨æ—¥æœŸ': shippingDate
                    }
                }]
            };

            addLog('cart-log', 'ğŸ“¤ å‘é€è¯·æ±‚åˆ° /cart/add.js...', 'info');
            addLog('cart-log', JSON.stringify(cartData, null, 2), 'info');

            // æ¨¡æ‹Ÿå»¶è¿Ÿ
            setTimeout(() => {
                addLog('cart-log', 'âœ… æ¨¡æ‹Ÿå“åº”æˆåŠŸï¼', 'success');
                addLog('cart-log', 'ğŸ”€ å‡†å¤‡è·³è½¬åˆ° /checkout...', 'success');
                addLog('cart-log', '', 'info');
                addLog('cart-log', 'ğŸ’¡ åœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œç°åœ¨ä¼šè·³è½¬åˆ° Shopify Checkout é¡µé¢', 'success');
                addLog('cart-log', 'ğŸ’¡ è®¢å•ä¼šåŒ…å«ä»¥ä¸‹ properties:', 'success');
                addLog('cart-log', '  - _preorder: "true"', 'success');
                addLog('cart-log', `  - _estimated_shipping: "${shippingDate}"`, 'success');
            }, 1000);
        }

        // Test 3: Test Webhook Detection
        function testWebhookDetection() {
            clearLog('webhook-log');
            addLog('webhook-log', 'ğŸ” æ¨¡æ‹Ÿ Webhook æ¥æ”¶è®¢å•...', 'info');

            // æ¨¡æ‹Ÿè®¢å•æ•°æ®
            const mockOrder = {
                id: 123456789,
                name: '#1001',
                email: 'customer@example.com',
                tags: '',
                line_items: [
                    {
                        id: 987654321,
                        product_id: 111222333,
                        variant_id: 444555666,
                        title: 'é™é‡æ¬¾è®¾è®¡å¸ˆå¤–å¥—',
                        price: '299.00',
                        quantity: 1,
                        properties: [
                            { name: '_preorder', value: 'true' },
                            { name: '_æ˜¯é è³¼å•†å“', value: 'æ˜¯' },
                            { name: '_estimated_shipping', value: '2025-12-15' }
                        ]
                    }
                ]
            };

            addLog('webhook-log', 'ğŸ“¦ è®¢å•æ•°æ®:', 'info');
            addLog('webhook-log', JSON.stringify(mockOrder, null, 2), 'info');
            addLog('webhook-log', '', 'info');

            // æ¨¡æ‹Ÿæ£€æµ‹é€»è¾‘
            setTimeout(() => {
                addLog('webhook-log', 'ğŸ” æ£€æŸ¥è®¢å•æ ‡ç­¾...', 'info');

                const hasPreorderTag = mockOrder.tags && mockOrder.tags.includes('preorder');
                addLog('webhook-log', `  - è®¢å•æ ‡ç­¾åŒ…å« "preorder": ${hasPreorderTag ? 'âœ… æ˜¯' : 'âŒ å¦'}`,
                    hasPreorderTag ? 'success' : 'info');

                addLog('webhook-log', '', 'info');
                addLog('webhook-log', 'ğŸ” æ£€æŸ¥ line_item properties...', 'info');

                let foundPreorder = false;
                mockOrder.line_items.forEach(item => {
                    if (item.properties) {
                        item.properties.forEach(prop => {
                            const isPreorder = prop.name.toLowerCase().includes('preorder') ||
                                prop.value.toLowerCase().includes('preorder');
                            if (isPreorder) {
                                foundPreorder = true;
                                addLog('webhook-log', `  - âœ… æ‰¾åˆ°é¢„è´­æ ‡è®°: ${prop.name} = ${prop.value}`, 'success');
                            }
                        });
                    }
                });

                addLog('webhook-log', '', 'info');
                if (foundPreorder) {
                    addLog('webhook-log', 'âœ… è¿™æ˜¯ä¸€ä¸ªé¢„è´­è®¢å•ï¼', 'success');
                    addLog('webhook-log', 'ğŸ’¾ å°†ä¿å­˜åˆ° preorder_orders è¡¨', 'success');
                    addLog('webhook-log', 'ğŸ“§ å°†å‘é€é¢„è´­ç¡®è®¤é‚®ä»¶', 'success');
                } else {
                    addLog('webhook-log', 'âŒ è¿™ä¸æ˜¯é¢„è´­è®¢å•', 'error');
                }
            }, 1000);
        }

        // Test 4: Full Flow
        async function testFullFlow() {
            clearLog('flow-log');
            addLog('flow-log', 'ğŸ¬ å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•...', 'info');
            addLog('flow-log', '', 'info');

            // Step 1
            await delay(500);
            addLog('flow-log', '1ï¸âƒ£ å®¢æˆ·è®¿é—®å”®ç½„äº§å“é¡µé¢', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… æ£€æµ‹åˆ°åº“å­˜ä¸º 0', 'success');

            // Step 2
            await delay(500);
            addLog('flow-log', '', 'info');
            addLog('flow-log', '2ï¸âƒ£ æ˜¾ç¤ºé¢„è´­æŒ‰é’®å’Œå¾½ç« ', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… é¢„è´­æŒ‰é’®å·²æ³¨å…¥', 'success');
            addLog('flow-log', '   âœ… é¢„è´­å¾½ç« å·²æ˜¾ç¤º', 'success');

            // Step 3
            await delay(500);
            addLog('flow-log', '', 'info');
            addLog('flow-log', '3ï¸âƒ£ å®¢æˆ·ç‚¹å‡»"Pre-Order Now"æŒ‰é’®', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… è°ƒç”¨ /cart/add.js API', 'success');

            // Step 4
            await delay(500);
            addLog('flow-log', '', 'info');
            addLog('flow-log', '4ï¸âƒ£ åŠ å…¥è´­ç‰©è½¦ï¼ˆå¸¦é¢„è´­æ ‡è®°ï¼‰', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… properties: { _preorder: "true" }', 'success');
            addLog('flow-log', '   âœ… å•†å“å·²æ·»åŠ åˆ°è´­ç‰©è½¦', 'success');

            // Step 5
            await delay(500);
            addLog('flow-log', '', 'info');
            addLog('flow-log', '5ï¸âƒ£ è‡ªåŠ¨è·³è½¬åˆ° Checkout', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… è·³è½¬åˆ° /checkout', 'success');

            // Step 6
            await delay(1000);
            addLog('flow-log', '', 'info');
            addLog('flow-log', '6ï¸âƒ£ å®¢æˆ·åœ¨ Checkout å®Œæˆæ”¯ä»˜', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… ä½¿ç”¨ Shopify åŸç”Ÿæ”¯ä»˜', 'success');
            addLog('flow-log', '   âœ… æ”¯æŒæ‰€æœ‰æ”¯ä»˜æ–¹å¼', 'success');

            // Step 7
            await delay(500);
            addLog('flow-log', '', 'info');
            addLog('flow-log', '7ï¸âƒ£ Shopify åˆ›å»ºè®¢å•', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… è®¢å• #1001 å·²åˆ›å»º', 'success');
            addLog('flow-log', '   âœ… line_items åŒ…å«é¢„è´­æ ‡è®°', 'success');

            // Step 8
            await delay(500);
            addLog('flow-log', '', 'info');
            addLog('flow-log', '8ï¸âƒ£ Webhook è§¦å‘', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… orders/create webhook å·²è§¦å‘', 'success');

            // Step 9
            await delay(500);
            addLog('flow-log', '', 'info');
            addLog('flow-log', '9ï¸âƒ£ App å¤„ç†é¢„è´­è®¢å•', 'info');
            await delay(500);
            addLog('flow-log', '   âœ… æ£€æµ‹åˆ°é¢„è´­æ ‡è®°', 'success');
            addLog('flow-log', '   âœ… ä¿å­˜åˆ° preorder_orders è¡¨', 'success');
            addLog('flow-log', '   âœ… å‘é€ç¡®è®¤é‚®ä»¶', 'success');

            // Step 10
            await delay(500);
            addLog('flow-log', '', 'info');
            addLog('flow-log', 'ğŸ‰ å®Œæ•´æµç¨‹æµ‹è¯•å®Œæˆï¼', 'success');
            addLog('flow-log', '', 'info');
            addLog('flow-log', 'ğŸ“Š æµç¨‹ç»Ÿè®¡:', 'info');
            addLog('flow-log', '   - æ€»è€—æ—¶: ~3 ç§’', 'success');
            addLog('flow-log', '   - ç”¨æˆ·æ­¥éª¤: 2 æ­¥ï¼ˆç‚¹å‡»é¢„è´­ â†’ å®Œæˆæ”¯ä»˜ï¼‰', 'success');
            addLog('flow-log', '   - è½¬åŒ–ç‡: é«˜', 'success');
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>

</html>