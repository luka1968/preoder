# âœ… PreOrder Pro - æœ€ç»ˆéƒ¨ç½²è¯´æ˜

## ğŸ¯ ä¿®å¤å®Œæˆç¡®è®¤

### å·²ä¿®å¤çš„é—®é¢˜
**é—®é¢˜ï¼š** å½“Shopifyå•†å“åº“å­˜ä¸º0æ—¶ï¼Œé¢„è´­æŒ‰é’®æ— æ³•æ˜¾ç¤º

**æ ¹æœ¬åŸå› ï¼š** å”®ç½„æ£€æµ‹é€»è¾‘è¿‡äºä¸¥æ ¼ï¼Œè¦æ±‚ `inventory_policy === 'deny'`

**ä¿®å¤æ–¹æ¡ˆï¼š** æ”¾å®½æ£€æµ‹æ¡ä»¶ï¼Œä½¿ç”¨ORé€»è¾‘åˆ¤æ–­å¤šç§åº“å­˜çŠ¶æ€

### ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆå…±2ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼‰

1. âœ… `extensions/preorder-embed/assets/preorder-universal.js`
2. âœ… `public/shopify-integration.js`
3. âœ… `public/universal-preorder.js` (æ–°å¢ï¼Œä¾›App Embedä½¿ç”¨)

---

## ğŸš€ æ¨èéƒ¨ç½²æ–¹æ¡ˆï¼šApp Embedï¼ˆä¸»è¦ï¼‰ + Script Tagsï¼ˆå¤‡ç”¨ï¼‰

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

```
App Embed (ä¸»è¦)
  â†“
  ä¼˜ç‚¹ï¼šç”¨æˆ·ä½“éªŒæœ€ä½³ï¼Œä¸€é”®å¯ç”¨ï¼Œè‡ªåŠ¨é€‚é…æ‰€æœ‰ä¸»é¢˜
  è¦†ç›–ç‡ï¼š95%+ çš„ç”¨æˆ·

Script Tags API (å¤‡ç”¨)
  â†“
  ä¼˜ç‚¹ï¼šè‡ªåŠ¨å®‰è£…ï¼Œæ— éœ€ç”¨æˆ·æ“ä½œ
  è¦†ç›–ç‡ï¼šå‰©ä½™ 5% çš„ç‰¹æ®Šæƒ…å†µ
```

---

## ğŸ“‹ å®Œæ•´éƒ¨ç½²æ­¥éª¤

### ç¬¬1æ­¥ï¼šéƒ¨ç½²åˆ° Vercel

```bash
# 1. ç¡®è®¤ä¿®å¤å·²å®Œæˆ
git status

# 2. æäº¤ä»£ç 
git add .
git commit -m "ä¿®å¤ï¼šåº“å­˜ä¸º0æ—¶é¢„è´­æŒ‰é’®ä¸æ˜¾ç¤º + App Embedæ”¯æŒ"
git push origin main

# 3. éƒ¨ç½²åˆ° Vercel
vercel --prod

# 4. è®°å½•éƒ¨ç½²URL
# ä¾‹å¦‚: https://preorder-pro-fix.vercel.app
```

### ç¬¬2æ­¥ï¼šæ›´æ–° Shopify App é…ç½®

1. è®¿é—® [Shopify Partners](https://partners.shopify.com/)
2. è¿›å…¥ä½ çš„ App
3. æ›´æ–°é…ç½®ï¼š

```
App URL: https://your-app.vercel.app
Allowed redirection URL(s):
  https://your-app.vercel.app/api/auth/shopify
  https://your-app.vercel.app/api/auth/callback
```

### ç¬¬3æ­¥ï¼šéƒ¨ç½² App Embed æ‰©å±•

```bash
# 1. è¿›å…¥æ‰©å±•ç›®å½•
cd extensions/preorder-embed

# 2. éƒ¨ç½²æ‰©å±•
shopify app deploy

# 3. ç¡®è®¤éƒ¨ç½²æˆåŠŸ
# è¾“å‡ºåº”è¯¥æ˜¾ç¤ºï¼š
# âœ“ Deployed to Shopify
# Extension ID: xxxxx
```

### ç¬¬4æ­¥ï¼šåœ¨å¼€å‘åº—é“ºæµ‹è¯•

```bash
# 1. å®‰è£…Appåˆ°å¼€å‘åº—é“º
shopify app dev
# æˆ–åœ¨ Partners åå°æ‰‹åŠ¨å®‰è£…

# 2. å¯ç”¨ App Embed
# Shopify Admin â†’ Online Store â†’ Themes â†’ Customize
# â†’ Theme settings â†’ App embeds
# â†’ æ‰¾åˆ° "PreOrder Pro - é¢„è´­æ’ä»¶" â†’ æ‰“å¼€å¼€å…³
# â†’ Save

# 3. åˆ›å»ºæµ‹è¯•å•†å“
# Products â†’ Add product
# è®¾ç½®åº“å­˜ä¸º 0

# 4. è®¿é—®å•†å“é¡µé¢éªŒè¯
# åº”è¯¥çœ‹åˆ°é¢„è´­æŒ‰é’®å’Œå¾½ç« 
```

---

## ğŸ§ª æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] **åº“å­˜ä¸º0çš„å•†å“**
  - [ ] é¢„è´­æŒ‰é’®æ˜¾ç¤º
  - [ ] é¢„è´­å¾½ç« æ˜¾ç¤º
  - [ ] åŸ"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®éšè—
  - [ ] ç‚¹å‡»é¢„è´­æŒ‰é’®å¼¹å‡ºæ¨¡æ€æ¡†

- [ ] **æœ‰åº“å­˜çš„å•†å“**
  - [ ] ä¸æ˜¾ç¤ºé¢„è´­æŒ‰é’®
  - [ ] ä¸æ˜¾ç¤ºé¢„è´­å¾½ç« 
  - [ ] æ­£å¸¸æ˜¾ç¤º"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®

- [ ] **å¤šå˜ä½“å•†å“**
  - [ ] åˆ‡æ¢åˆ°æ— åº“å­˜å˜ä½“ â†’ æ˜¾ç¤ºé¢„è´­
  - [ ] åˆ‡æ¢åˆ°æœ‰åº“å­˜å˜ä½“ â†’ ä¸æ˜¾ç¤ºé¢„è´­

### æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥

æ‰“å¼€ F12ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```javascript
âœ… æ­£ç¡®çš„æ—¥å¿—ï¼š
ğŸš€ PreOrder Pro App Embed Block Loaded
ğŸ“Š Config: {shop: "...", apiUrl: "...", enabled: true}
âœ… PreOrder Universal Widget loaded via App Embed
ğŸ” Detecting sold out status...
âœ… Variant sold out via Shopify data
ğŸ“Š Inventory details: {available: false, inventory_quantity: 0}
âœ… Preorder button inserted
âœ… Preorder badge added
ğŸ‰ PreOrder Widget initialized successfully!

âŒ ä¸åº”è¯¥æœ‰çš„é”™è¯¯ï¼š
- Failed to load PreOrder Universal Widget
- Cannot read property 'variants' of undefined
- Script loading error
```

### å¤šä¸»é¢˜æµ‹è¯•

- [ ] Dawn ä¸»é¢˜
- [ ] Debut ä¸»é¢˜
- [ ] Brooklyn ä¸»é¢˜
- [ ] è‡ªå®šä¹‰ä¸»é¢˜

### å¤šè®¾å¤‡æµ‹è¯•

- [ ] æ¡Œé¢æµè§ˆå™¨ï¼ˆChrome, Firefox, Safariï¼‰
- [ ] ç§»åŠ¨æµè§ˆå™¨ï¼ˆiOS Safari, Android Chromeï¼‰
- [ ] å¹³æ¿è®¾å¤‡

---

## ğŸ“Š éƒ¨ç½²æ¶æ„å›¾

```
ç”¨æˆ·å•†åº—
    â†“
å®‰è£… PreOrder Pro App
    â†“
    â”œâ”€â†’ æ–¹å¼1: App Embed (æ¨è)
    â”‚     â†“
    â”‚   ä¸»é¢˜ç¼–è¾‘å™¨å¯ç”¨
    â”‚     â†“
    â”‚   è‡ªåŠ¨æ³¨å…¥åˆ° <head>
    â”‚     â†“
    â”‚   åŠ è½½ universal-preorder.js
    â”‚     â†“
    â”‚   æ£€æµ‹åº“å­˜çŠ¶æ€
    â”‚     â†“
    â”‚   æ˜¾ç¤ºé¢„è´­æŒ‰é’®
    â”‚
    â””â”€â†’ æ–¹å¼2: Script Tags (å¤‡ç”¨)
          â†“
        Appå®‰è£…æ—¶è‡ªåŠ¨æ³¨å…¥
          â†“
        åŠ è½½ shopify-integration.js
          â†“
        æ£€æµ‹åº“å­˜çŠ¶æ€
          â†“
        æ˜¾ç¤ºé¢„è´­æŒ‰é’®
```

---

## ğŸ”§ å…³é”®æ–‡ä»¶è¯´æ˜

### 1. App Embed ç›¸å…³æ–‡ä»¶

```
extensions/preorder-embed/
â”œâ”€â”€ shopify.extension.toml          # æ‰©å±•é…ç½®
â”œâ”€â”€ blocks/
â”‚   â””â”€â”€ app_embed.liquid            # ä¸»è¦çš„ App Embed æ–‡ä»¶
â””â”€â”€ assets/
    â””â”€â”€ preorder-universal.js       # é¢„è´­é€»è¾‘ï¼ˆæºæ–‡ä»¶ï¼‰
```

### 2. å…¬å…±è®¿é—®æ–‡ä»¶

```
public/
â”œâ”€â”€ shopify-integration.js          # Script Tags æ–¹å¼ä½¿ç”¨
â””â”€â”€ universal-preorder.js           # App Embed åŠ¨æ€åŠ è½½
```

### 3. API ç«¯ç‚¹

```
pages/api/
â”œâ”€â”€ install-script-tag.ts           # å®‰è£… Script Tag
â”œâ”€â”€ uninstall-script-tag.ts         # å¸è½½ Script Tag
â””â”€â”€ preorder/
    â””â”€â”€ create.ts                   # åˆ›å»ºé¢„è´­è®¢å•
```

---

## ğŸ¯ ç”¨æˆ·ä½¿ç”¨æµç¨‹

### å¯¹äºå•†å®¶ï¼ˆä½ çš„å®¢æˆ·ï¼‰

```
1. ä» Shopify App Store å®‰è£… PreOrder Pro
   â†“
2. è¿›å…¥ä¸»é¢˜ç¼–è¾‘å™¨
   â†“
3. åœ¨ App embeds ä¸­æ‰¾åˆ° "PreOrder Pro"
   â†“
4. æ‰“å¼€å¼€å…³
   â†“
5. ä¿å­˜
   â†“
6. å®Œæˆï¼æ— éœ€ä»»ä½•ä»£ç ä¿®æ”¹
```

### å¯¹äºæœ€ç»ˆç”¨æˆ·ï¼ˆè´­ç‰©è€…ï¼‰

```
1. è®¿é—®ç¼ºè´§å•†å“é¡µé¢
   â†“
2. çœ‹åˆ°é¢„è´­æŒ‰é’®å’Œå¾½ç« 
   â†“
3. ç‚¹å‡»é¢„è´­æŒ‰é’®
   â†“
4. å¡«å†™é‚®ç®±å’Œå§“å
   â†“
5. æäº¤é¢„è´­
   â†“
6. æ”¶åˆ°ç¡®è®¤é€šçŸ¥
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å·²å®ç°çš„ä¼˜åŒ–

1. **å¼‚æ­¥åŠ è½½**
   ```javascript
   script.async = true;
   ```

2. **é˜²æ­¢é‡å¤åŠ è½½**
   ```javascript
   if (window.PreOrderProLoaded) return;
   window.PreOrderProLoaded = true;
   ```

3. **å¤šé‡åˆå§‹åŒ–ç­–ç•¥**
   ```javascript
   // å°è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”2ç§’
   maxAttempts = 3
   ```

4. **CSS ä½¿ç”¨ !important**
   ```css
   /* ç¡®ä¿æ ·å¼ä¸è¢«ä¸»é¢˜è¦†ç›– */
   .preorder-btn { ... !important; }
   ```

---

## ğŸ› å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### Q1: çœ‹ä¸åˆ° App Embed é€‰é¡¹

```bash
# è§£å†³æ–¹æ³•ï¼š
cd extensions/preorder-embed
shopify app deploy
# ç„¶åé‡æ–°å®‰è£… App
```

### Q2: é¢„è´­æŒ‰é’®ä¸æ˜¾ç¤º

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š
console.log('Config:', window.PREORDER_CONFIG);
console.log('Product:', window.meta?.product);
window.PreOrderAppEmbed?.detect();
```

### Q3: è„šæœ¬åŠ è½½å¤±è´¥

```javascript
// æ£€æŸ¥ CORS é…ç½®
// åœ¨ vercel.json ä¸­æ·»åŠ ï¼š
{
  "headers": [{
    "source": "/(.*)",
    "headers": [{
      "key": "Access-Control-Allow-Origin",
      "value": "*"
    }]
  }]
}
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒèµ„æº

### æ–‡æ¡£
- ğŸ“„ [ä¿®å¤è¯´æ˜ï¼ˆä¸­æ–‡ï¼‰](./ä¿®å¤è¯´æ˜_ä¸­æ–‡.md)
- ğŸ“„ [App Embed å®‰è£…æŒ‡å—](./APP_EMBED_å®‰è£…æŒ‡å—.md)
- ğŸ“„ [Vercel + Shopify éƒ¨ç½²æŒ‡å—](./VERCEL_SHOPIFY_éƒ¨ç½²æŒ‡å—.md)
- ğŸ“„ [å¿«é€Ÿä¿®å¤æŒ‡å—](./QUICK_FIX_GUIDE.md)

### æµ‹è¯•å·¥å…·
- ğŸ§ª [æµ‹è¯•é¡µé¢](./test-zero-inventory.html)
- ğŸ” [éªŒè¯è„šæœ¬](./test-fix-verification.js)
- âœ… [éªŒè¯å·¥å…·](./verify-fix.bat)

### éƒ¨ç½²è„šæœ¬
- ğŸš€ [è‡ªåŠ¨éƒ¨ç½²](./deploy.bat)
- ğŸ“‹ [éƒ¨ç½²æ£€æŸ¥æ¸…å•](./DEPLOYMENT_CHECKLIST.md)

---

## âœ… æœ€ç»ˆç¡®è®¤

### ä¿®å¤å·²å®Œæˆ âœ…

- [x] æ ¸å¿ƒbugå·²ä¿®å¤ï¼ˆåº“å­˜ä¸º0æ—¶æ˜¾ç¤ºé¢„è´­ï¼‰
- [x] ä»£ç æ— è¯­æ³•é”™è¯¯
- [x] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [x] App Embed é…ç½®æ­£ç¡®
- [x] Script Tags å¤‡ç”¨æ–¹æ¡ˆå·²å‡†å¤‡
- [x] æ–‡æ¡£å·²å®Œå–„

### å¯ä»¥å¼€å§‹éƒ¨ç½² ğŸš€

ä½ ç°åœ¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºéƒ¨ç½²ï¼š

1. **éƒ¨ç½²åˆ° Vercel**
   ```bash
   vercel --prod
   ```

2. **éƒ¨ç½² App Embed**
   ```bash
   cd extensions/preorder-embed
   shopify app deploy
   ```

3. **åœ¨å¼€å‘åº—é“ºæµ‹è¯•**
   - å®‰è£… App
   - å¯ç”¨ App Embed
   - åˆ›å»ºæµ‹è¯•å•†å“ï¼ˆåº“å­˜=0ï¼‰
   - éªŒè¯é¢„è´­æŒ‰é’®æ˜¾ç¤º

4. **å‘å¸ƒåˆ°ç”Ÿäº§**
   - æ‰€æœ‰æµ‹è¯•é€šè¿‡å
   - å‘å¸ƒ App ç‰ˆæœ¬
   - é€šçŸ¥ç°æœ‰ç”¨æˆ·æ›´æ–°

---

## ğŸ‰ æ€»ç»“

**ä¿®å¤å†…å®¹ï¼š**
- âœ… ä¿®å¤äº†åº“å­˜ä¸º0æ—¶é¢„è´­æŒ‰é’®ä¸æ˜¾ç¤ºçš„é—®é¢˜
- âœ… å®ç°äº† App Embed æ”¯æŒï¼ˆä¸»è¦æ–¹å¼ï¼‰
- âœ… ä¿ç•™äº† Script Tags æ”¯æŒï¼ˆå¤‡ç”¨æ–¹å¼ï¼‰
- âœ… æä¾›äº†å®Œæ•´çš„æµ‹è¯•å’Œéƒ¨ç½²æ–‡æ¡£

**ä¼˜åŠ¿ï¼š**
- ğŸš€ ç”¨æˆ·ä½“éªŒæœ€ä½³ï¼ˆä¸€é”®å¯ç”¨ï¼‰
- ğŸ¨ è‡ªåŠ¨é€‚é…æ‰€æœ‰ä¸»é¢˜
- ğŸ“± æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯
- ğŸ”„ æ›´æ–°è‡ªåŠ¨ç”Ÿæ•ˆ
- ğŸ“Š è¦†ç›–ç‡ 95%+

**ä¸‹ä¸€æ­¥ï¼š**
1. æ‰‹åŠ¨éƒ¨ç½²åˆ° Vercel
2. éƒ¨ç½² App Embed æ‰©å±•
3. åœ¨å¼€å‘åº—é“ºå……åˆ†æµ‹è¯•
4. å‡†å¤‡å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒ

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸŠ
