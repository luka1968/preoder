# ✅ 预购应用快速测试清单

## 🎯 你的 Vercel URL
**重要**：请先找到你的 Vercel 部署 URL
- 登录 https://vercel.com
- 找到你的项目
- 复制 URL（例如：`https://preoder-xxxx.vercel.app`）

---

## 📋 5分钟快速测试

### ✅ Step 1: 安装应用到 Shopify（必须）

**方式1：OAuth 安装（推荐）**
```
https://你的vercel应用.vercel.app/api/auth?shop=你的商店名.myshopify.com
```

例如：
```
https://preoder-abc123.vercel.app/api/auth?shop=test-store.myshopify.com
```

**期望结果**：
- 跳转到 Shopify 授权页面
- 点击"安装"后回调到你的应用
- 看到管理界面或成功消息

---

### ✅ Step 2: 访问管理界面

安装成功后访问：
```
https://你的vercel应用.vercel.app/admin?shop=你的商店名.myshopify.com
```

**期望看到**：
- 📊 Dashboard（仪表板）
- 📦 Products（产品管理）
- 📋 Orders（订单列表）
- ⚙️ Settings（设置）

---

### ✅ Step 3: 设置测试产品

1. **在 Shopify 后台**：
   - 进入 `Products` → 选择或创建一个产品
   - 设置库存为 **0**（触发预购）
   - 保存

2. **在预购应用管理界面**：
   - 进入 `Products` 页面
   - 找到刚才的产品
   - 点击"Enable Pre-order"
   - 可选：设置预计到货日期

---

### ✅ Step 4: 添加前端脚本到主题

#### 方法 A：App Embed（如果支持）
1. 进入 Shopify Admin → `Online Store` → `Themes`
2. 点击 `Customize`
3. 在左侧找到 `App embeds`
4. 启用你的预购应用
5. 保存

#### 方法 B：手动添加到 theme.liquid
1. 进入 `Online Store` → `Themes` → `Actions` → `Edit code`
2. 打开 `layout/theme.liquid`
3. 在 `</head>` 前面添加：

```html
<!-- PreOrder App -->
<script>
  window.PREORDER_CONFIG = {
    enabled: true,
    apiUrl: 'https://你的vercel应用.vercel.app',
    shop: '{{ shop.permanent_domain }}'
  };
</script>
<script src="https://你的vercel应用.vercel.app/universal-preorder.js"></script>
```

4. **替换** `你的vercel应用.vercel.app` 为你的实际 URL
5. 保存

---

### ✅ Step 5: 测试前端显示

1. **访问产品页面**：
   ```
   https://你的商店.myshopify.com/products/测试产品
   ```

2. **期望看到**：
   - ❌ "Add to Cart" 按钮被隐藏
   - ✅ "Pre-Order Now" 按钮显示（橙色/醒目）
   - 📅 可能显示预计到货日期

3. **检查浏览器控制台（按 F12）**：
   ```
   [PreOrder] Script loaded
   [PreOrder] Product is out of stock
   [PreOrder] Showing pre-order button
   ```

---

### ✅ Step 6: 提交测试订单

1. **点击 "Pre-Order Now" 按钮**
2. **填写表单**：
   - Email: `test@example.com`
   - Quantity: `1`
3. **点击提交**

**期望结果**：
- ✅ 显示成功消息
- ✅ 表单自动关闭

---

### ✅ Step 7: 验证订单创建

#### 7.1 检查 Shopify Draft Orders
1. 进入 Shopify Admin
2. 搜索 `Draft Orders` 或访问：
   ```
   https://你的商店.myshopify.com/admin/draft_orders
   ```
3. **期望看到**：
   - 新的 Draft Order
   - Customer: `test@example.com`
   - 包含你测试的产品
   - Tags: `preorder`

#### 7.2 检查预购应用管理界面
1. 访问应用的 Orders 页面：
   ```
   https://你的vercel应用.vercel.app/admin/orders?shop=你的商店.myshopify.com
   ```
2. **期望看到**：
   - 刚创建的预购订单
   - Status: Pending
   - Customer email 正确

---

## 🐛 快速故障排除

### 问题1：管理界面打不开
**检查**：
- ✅ Vercel URL 正确吗？
- ✅ Shop 参数正确吗？例如：`?shop=yourstore.myshopify.com`
- ✅ 是否已完成 OAuth 安装？

### 问题2：预购按钮不显示
**检查**：
- ✅ 产品库存是否为 0？
- ✅ 脚本是否加载？打开浏览器控制台（F12）看是否有错误
- ✅ `PREORDER_CONFIG` 是否正确？在控制台输入 `console.log(window.PREORDER_CONFIG)`

### 问题3：提交订单失败（500错误）
**检查**：
- ✅ Vercel 环境变量是否都设置了？
  - `SHOPIFY_API_KEY`
  - `SHOPIFY_API_SECRET`
  - `SUPABASE_URL`
  - `SUPABASE_SERVICE_ROLE_KEY`
- ✅ Vercel Function Logs 显示什么错误？

### 问题4：Draft Order 没创建
**检查**：
- ✅ Shopify API 权限是否包含 `write_draft_orders`？
- ✅ Shop 的 access_token 是否有效？重新安装应用试试
- ✅ 查看 Vercel Logs 获取详细错误

---

## 📚 更多资源

- **详细测试指南**：`PREORDER_TESTING_GUIDE.md`
- **快速设置指南**：`QUICK_SETUP_GUIDE.md`
- **Globo 模式说明**：`GLOBO_MODE_MIGRATION_GUIDE.md`

---

## ✨ 测试成功后的下一步

1. ✅ **自定义样式**：修改预购按钮和徽章的颜色、文字
2. ✅ **设置邮件**：配置订单通知邮件模板
3. ✅ **监控订单**：定期查看 Dashboard 统计
4. ✅ **库存管理**：产品补货后自动通知客户

---

**祝测试顺利！** 🎉

如果遇到任何问题，请查看浏览器控制台和 Vercel Logs 中的错误信息。
