<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>库存为零测试 - PreOrder Pro</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      background: #f5f5f5;
    }
    .test-container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .test-case {
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .test-case h3 {
      margin-top: 0;
      color: #ff6b35;
    }
    .product-mock {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    .product-image {
      position: relative;
      background: #f0f0f0;
      height: 300px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
    }
    .product-info {
      padding: 20px;
    }
    .product-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .product-price {
      font-size: 20px;
      color: #333;
      margin-bottom: 20px;
    }
    button[name="add"] {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 10px;
    }
    button[name="add"]:disabled {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
    }
    .variant-select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      margin-left: 10px;
    }
    .status-success {
      background: #d4edda;
      color: #155724;
    }
    .status-error {
      background: #f8d7da;
      color: #721c24;
    }
    .code-block {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      overflow-x: auto;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>🧪 库存为零预购按钮测试</h1>
    <p class="subtitle">测试不同库存状态下预购按钮的显示情况</p>
    
    <div style="background: #fff3cd; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
      <strong>⚠️ 测试说明：</strong>
      <ul style="margin: 10px 0 0 0; padding-left: 20px;">
        <li>每个测试用例模拟不同的库存状态</li>
        <li>预购按钮应该在库存为0时自动显示</li>
        <li>打开浏览器控制台查看详细日志</li>
      </ul>
    </div>
  </div>

  <!-- 测试用例1: available = false -->
  <div class="test-container">
    <div class="test-case">
      <h3>测试用例 1: available = false <span class="status-badge status-success">应显示预购</span></h3>
      <p>变体的 <code>available</code> 字段为 <code>false</code></p>
      
      <div class="product-mock">
        <div class="product-image" id="image-1">
          <span>产品图片</span>
        </div>
        <div class="product-info">
          <div class="product-title">测试商品 1</div>
          <div class="product-price">¥99.00</div>
          <select name="id" class="variant-select">
            <option value="test-variant-1">默认变体</option>
          </select>
          <button name="add" disabled>售罄</button>
        </div>
      </div>
      
      <div class="code-block">
window.meta = {
  product: {
    id: 'test-product-1',
    variants: [{
      id: 'test-variant-1',
      available: false,
      inventory_quantity: 0
    }]
  }
}
      </div>
    </div>
  </div>

  <!-- 测试用例2: inventory_quantity = 0 -->
  <div class="test-container">
    <div class="test-case">
      <h3>测试用例 2: inventory_quantity = 0 <span class="status-badge status-success">应显示预购</span></h3>
      <p>变体的 <code>inventory_quantity</code> 为 <code>0</code></p>
      
      <div class="product-mock">
        <div class="product-image" id="image-2">
          <span>产品图片</span>
        </div>
        <div class="product-info">
          <div class="product-title">测试商品 2</div>
          <div class="product-price">¥149.00</div>
          <select name="id" class="variant-select">
            <option value="test-variant-2">默认变体</option>
          </select>
          <button name="add" disabled>缺货</button>
        </div>
      </div>
      
      <div class="code-block">
window.meta = {
  product: {
    id: 'test-product-2',
    variants: [{
      id: 'test-variant-2',
      available: true,
      inventory_quantity: 0,
      inventory_management: 'shopify'
    }]
  }
}
      </div>
    </div>
  </div>

  <!-- 测试用例3: 负库存 -->
  <div class="test-container">
    <div class="test-case">
      <h3>测试用例 3: inventory_quantity = -5 <span class="status-badge status-success">应显示预购</span></h3>
      <p>变体的 <code>inventory_quantity</code> 为负数</p>
      
      <div class="product-mock">
        <div class="product-image" id="image-3">
          <span>产品图片</span>
        </div>
        <div class="product-info">
          <div class="product-title">测试商品 3</div>
          <div class="product-price">¥199.00</div>
          <select name="id" class="variant-select">
            <option value="test-variant-3">默认变体</option>
          </select>
          <button name="add" disabled>Sold out</button>
        </div>
      </div>
      
      <div class="code-block">
window.meta = {
  product: {
    id: 'test-product-3',
    variants: [{
      id: 'test-variant-3',
      available: false,
      inventory_quantity: -5,
      inventory_management: 'shopify'
    }]
  }
}
      </div>
    </div>
  </div>

  <!-- 测试用例4: 有库存（不应显示预购） -->
  <div class="test-container">
    <div class="test-case">
      <h3>测试用例 4: inventory_quantity = 10 <span class="status-badge status-error">不应显示预购</span></h3>
      <p>变体有库存，<code>inventory_quantity = 10</code></p>
      
      <div class="product-mock">
        <div class="product-image" id="image-4">
          <span>产品图片</span>
        </div>
        <div class="product-info">
          <div class="product-title">测试商品 4</div>
          <div class="product-price">¥79.00</div>
          <select name="id" class="variant-select">
            <option value="test-variant-4">默认变体</option>
          </select>
          <button name="add" style="background: #28a745; color: white;">加入购物车</button>
        </div>
      </div>
      
      <div class="code-block">
window.meta = {
  product: {
    id: 'test-product-4',
    variants: [{
      id: 'test-variant-4',
      available: true,
      inventory_quantity: 10,
      inventory_management: 'shopify'
    }]
  }
}
      </div>
    </div>
  </div>

  <!-- 模拟Shopify环境 -->
  <script>
    // 模拟Shopify全局对象
    window.Shopify = {
      shop: 'test-shop.myshopify.com'
    };

    // 设置不同测试用例的产品数据
    // 这里我们会在加载脚本前设置
    console.log('🧪 测试环境初始化完成');
    console.log('📦 Shopify对象:', window.Shopify);
  </script>

  <!-- 加载修复后的预购脚本 -->
  <script src="/shopify-integration.js"></script>

  <!-- 测试结果验证 -->
  <script>
    setTimeout(() => {
      console.log('='.repeat(50));
      console.log('🔍 验证测试结果');
      console.log('='.repeat(50));
      
      // 检查每个测试用例
      for (let i = 1; i <= 4; i++) {
        const container = document.querySelectorAll('.test-case')[i-1];
        const preorderBtn = container.querySelector('.preorder-btn');
        const badge = document.querySelector(`#image-${i} .preorder-badge`);
        
        const shouldShow = i <= 3; // 前3个应该显示预购
        const hasButton = !!preorderBtn;
        const hasBadge = !!badge;
        
        const status = (shouldShow === hasButton) ? '✅' : '❌';
        
        console.log(`测试用例 ${i}: ${status}`);
        console.log(`  - 应显示预购: ${shouldShow}`);
        console.log(`  - 实际显示按钮: ${hasButton}`);
        console.log(`  - 实际显示徽章: ${hasBadge}`);
        
        if (shouldShow !== hasButton) {
          console.error(`  ⚠️ 测试失败！预期${shouldShow ? '显示' : '不显示'}预购按钮`);
        }
      }
      
      console.log('='.repeat(50));
    }, 2000);
  </script>

  <!-- 为每个测试用例设置独立的产品数据 -->
  <script>
    // 由于我们需要为每个产品设置不同的数据，
    // 我们需要修改脚本以支持多个产品
    // 这里先设置第一个产品的数据
    window.meta = {
      product: {
        id: 'test-product-1',
        variants: [{
          id: 'test-variant-1',
          available: false,
          inventory_quantity: 0
        }]
      }
    };
  </script>
</body>
</html>
