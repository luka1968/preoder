# ğŸ“‹ Supabase æ•°æ®åº“è¡¨æ‰§è¡Œæ¸…å•

---

## âœ… æ‰§è¡Œé¡ºåºï¼ˆé‡è¦ï¼ï¼‰

### **ç¬¬ 1 æ­¥ï¼šä¿®å¤ shops è¡¨**

ğŸ“„ **æ–‡ä»¶**: `supabase-fix-shops-table.sql`

**ç”¨é€”**: æ›´æ–°ç°æœ‰çš„ shops è¡¨ï¼Œæ·»åŠ ç¼ºå¤±çš„åˆ—

**æ‰§è¡Œæ—¶æœº**: â­ **ç«‹å³æ‰§è¡Œ**ï¼ˆä½ çš„ shops è¡¨ç¼ºå°‘ `is_active` ç­‰åˆ—ï¼‰

**é¢„æœŸç»“æœ**:
```
âœ… shops è¡¨æ›´æ–°æˆåŠŸï¼
```

---

### **ç¬¬ 2 æ­¥ï¼šåˆ›å»º preorder_orders è¡¨**

ğŸ“„ **æ–‡ä»¶**: `supabase-preorder-orders-table.sql`

**ç”¨é€”**: åˆ›å»ºé¢„è´­è®¢å•ä¸»è¡¨

**æ‰§è¡Œæ—¶æœº**: åœ¨ç¬¬ 1 æ­¥å®Œæˆåæ‰§è¡Œ

**æ³¨æ„**: 
- âœ… å·²ä¿®å¤å¤–é”®ç±»å‹ï¼ˆ`shop_id` ä¸º `BIGINT`ï¼‰
- âœ… åŒ…å«æ‰€æœ‰ç´¢å¼•å’Œè§¦å‘å™¨

**é¢„æœŸç»“æœ**:
```
Success. No rows returned
```

---

### **ç¬¬ 3 æ­¥ï¼šåˆ›å»º preorder_products è¡¨ï¼ˆå¯é€‰ï¼‰**

ğŸ“„ **æ–‡ä»¶**: `supabase-preorder-products-table.sql`

**ç”¨é€”**: å­˜å‚¨å¯ç”¨é¢„è´­çš„äº§å“é…ç½®

**æ‰§è¡Œæ—¶æœº**: åœ¨ç¬¬ 2 æ­¥å®Œæˆå

**æ˜¯å¦å¿…éœ€**: æ ¹æ®ä½ çš„éœ€æ±‚
- âœ… å¦‚æœéœ€è¦åœ¨åº”ç”¨ä¸­ç®¡ç†é¢„è´­äº§å“è®¾ç½®ï¼Œæ‰§è¡Œè¿™ä¸ª
- âŒ å¦‚æœåªç”¨ Shopify Metafield ç®¡ç†ï¼Œå¯ä»¥è·³è¿‡

---

### **ç¬¬ 4 æ­¥ï¼šåˆ›å»º preorders è¡¨ï¼ˆå¯é€‰ï¼‰**

ğŸ“„ **æ–‡ä»¶**: `supabase-preorders-table.sql`

**ç”¨é€”**: å¦ä¸€ä¸ªè®¢å•è¡¨ï¼ˆå¯èƒ½æ˜¯æ—§ç‰ˆæœ¬ï¼‰

**å»ºè®®**: âš ï¸ **æ£€æŸ¥æ˜¯å¦éœ€è¦**
- ä½ å¯èƒ½ä¸éœ€è¦åŒæ—¶æœ‰ `preorder_orders` å’Œ `preorders` ä¸¤ä¸ªè¡¨
- å»ºè®®åªç”¨ `preorder_orders`

---

## ğŸ¯ æ¨èæ‰§è¡Œæ–¹æ¡ˆ

### **æ–¹æ¡ˆ Aï¼šæœ€å°åŒ–é…ç½®ï¼ˆæ¨èï¼‰**

é€‚åˆå¿«é€Ÿä¸Šçº¿ï¼Œåªåˆ›å»ºå¿…éœ€çš„è¡¨ï¼š

```sql
-- 1ï¸âƒ£ ä¿®å¤ shops è¡¨
æ‰§è¡Œ: supabase-fix-shops-table.sql

-- 2ï¸âƒ£ åˆ›å»º preorder_orders è¡¨
æ‰§è¡Œ: supabase-preorder-orders-table.sql

-- âœ… å®Œæˆï¼
```

### **æ–¹æ¡ˆ Bï¼šå®Œæ•´é…ç½®**

å¦‚æœéœ€è¦å®Œæ•´çš„åŠŸèƒ½ï¼š

```sql
-- 1ï¸âƒ£ ä¿®å¤ shops è¡¨
æ‰§è¡Œ: supabase-fix-shops-table.sql

-- 2ï¸âƒ£ åˆ›å»º preorder_orders è¡¨
æ‰§è¡Œ: supabase-preorder-orders-table.sql

-- 3ï¸âƒ£ åˆ›å»º preorder_products è¡¨
æ‰§è¡Œ: supabase-preorder-products-table.sql

-- âœ… å®Œæˆï¼
```

---

## ğŸ“Š æ‰€æœ‰å¯ç”¨çš„ SQL æ–‡ä»¶

| æ–‡ä»¶å | ç”¨é€” | æ˜¯å¦å¿…éœ€ | æ‰§è¡Œé¡ºåº |
|--------|------|----------|----------|
| âœ… `supabase-fix-shops-table.sql` | ä¿®å¤ç°æœ‰ shops è¡¨ | **å¿…éœ€** | 1ï¸âƒ£ |
| âœ… `supabase-preorder-orders-table.sql` | åˆ›å»ºè®¢å•è¡¨ | **å¿…éœ€** | 2ï¸âƒ£ |
| âš ï¸ `supabase-preorder-products-table.sql` | åˆ›å»ºäº§å“é…ç½®è¡¨ | å¯é€‰ | 3ï¸âƒ£ |
| âŒ `supabase-preorders-table.sql` | æ—§ç‰ˆè®¢å•è¡¨ | **ä¸æ¨è** | - |
| âŒ `supabase-shops-table.sql` | åˆ›å»ºæ–° shops è¡¨ | **ä¸éœ€è¦** | - |
| âŒ `supabase-migration-fix-foreign-key.sql` | è¿ç§»è„šæœ¬ | **ä¸éœ€è¦** | - |

**è¯´æ˜**:
- âœ… = æ¨èæ‰§è¡Œ
- âš ï¸ = æ ¹æ®éœ€æ±‚å†³å®š
- âŒ = ä½ ä¸éœ€è¦æ‰§è¡Œï¼ˆå·²æœ‰æ›´å¥½çš„æ›¿ä»£ï¼‰

---

## ğŸ” æ£€æŸ¥å½“å‰çŠ¶æ€

åœ¨æ‰§è¡Œå‰ï¼Œå…ˆè¿è¡Œè¿™ä¸ªæŸ¥è¯¢çœ‹çœ‹ä½ å·²æœ‰å“ªäº›è¡¨ï¼š

```sql
SELECT 
    table_name,
    (SELECT COUNT(*) FROM information_schema.columns WHERE columns.table_name = tables.table_name) as column_count
FROM information_schema.tables
WHERE table_schema = 'public'
  AND table_name IN ('shops', 'preorder_orders', 'preorder_products', 'preorders')
ORDER BY table_name;
```

**æ ¹æ®ç»“æœ**:
- `shops` å­˜åœ¨ â†’ æ‰§è¡Œ `supabase-fix-shops-table.sql`
- `preorder_orders` ä¸å­˜åœ¨ â†’ æ‰§è¡Œ `supabase-preorder-orders-table.sql`
- `preorder_products` ä¸å­˜åœ¨ â†’ æ ¹æ®éœ€æ±‚æ‰§è¡Œ

---

## âœ… æ‰§è¡ŒåéªŒè¯

å…¨éƒ¨æ‰§è¡Œå®Œåï¼Œè¿è¡Œè¿™ä¸ªéªŒè¯ï¼š

```sql
-- éªŒè¯æ‰€æœ‰è¡¨å’Œåˆ—
SELECT 
    t.table_name,
    c.column_name,
    c.data_type,
    CASE 
        WHEN c.is_nullable = 'NO' THEN 'NOT NULL'
        ELSE 'NULL'
    END as nullable
FROM information_schema.tables t
JOIN information_schema.columns c 
    ON t.table_name = c.table_name
WHERE t.table_schema = 'public'
  AND t.table_name IN ('shops', 'preorder_orders')
ORDER BY t.table_name, c.ordinal_position;
```

**æœŸæœ›ç»“æœ**:
- `shops` è¡¨åº”è¯¥æœ‰ 8 åˆ—ï¼ˆåŒ…æ‹¬ `is_active`ï¼‰
- `preorder_orders` è¡¨åº”è¯¥æœ‰ 14 åˆ—ï¼ˆ`shop_id` ç±»å‹ä¸º `bigint`ï¼‰

---

## ğŸš€ æˆ‘çš„å»ºè®®

**ç«‹å³æ‰§è¡Œè¿™ä¸¤ä¸ª**ï¼ˆæŒ‰é¡ºåºï¼‰:

1. `supabase-fix-shops-table.sql` â­
2. `supabase-preorder-orders-table.sql` â­

ç„¶åæµ‹è¯•ä¸€ä¸‹åˆ›å»ºé¢„è´­è®¢å•æ˜¯å¦æ­£å¸¸ã€‚å¦‚æœæœ‰éœ€è¦ï¼Œå†æ·»åŠ å…¶ä»–è¡¨ã€‚

**éœ€è¦æˆ‘å¸®ä½ åˆ›å»ºä¸€ä¸ªåˆå¹¶çš„æ‰§è¡Œè„šæœ¬å—ï¼Ÿ**ï¼ˆæŠŠè¿™ä¸¤ä¸ªåˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶ï¼Œä¸€æ¬¡æ€§æ‰§è¡Œå®Œï¼‰
